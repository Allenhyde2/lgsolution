<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>canD 솔루션 개발 일정표</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
        }

        /* Spreadsheet Grid Styles */
        .sheet-container {
            overflow: auto;
            max-height: calc(100vh - 60px);
            border: 1px solid #d1d5db;
            background-color: white;
        }

        table {
            border-collapse: separate; /* For sticky headers/cells */
            border-spacing: 0;
            min-width: 100%;
            font-size: 13px;
        }

        th, td {
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            padding: 8px;
            white-space: nowrap;
            height: 32px;
        }

        /* Header Styles */
        th {
            background-color: #f3f4f6;
            color: #374151;
            font-weight: 600;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 20;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            border-top: 1px solid #e5e7eb;
        }
        
        /* Fix left border for first column */
        th:first-child, td:first-child {
            border-left: 1px solid #e5e7eb;
        }

        /* Row Number Column */
        .row-num {
            background-color: #f9fafb;
            color: #6b7280;
            text-align: center;
            width: 40px;
            font-size: 11px;
            user-select: none;
            position: sticky;
            left: 0;
            z-index: 10;
        }

        /* Cell Interaction */
        td[contenteditable="true"]:focus {
            outline: 2px solid #10b981;
            outline-offset: -2px;
            background-color: white;
        }

        /* Timeline Cell Base */
        .timeline-cell {
            text-align: center;
            cursor: pointer;
            transition: background-color 0.1s;
            width: 60px;
        }
        
        .timeline-cell:hover {
            background-color: #f3f4f6;
        }

        /* Timeline Cell Active States (Colors) */
        /* Default Green */
        .timeline-cell.active {
            background-color: #d1fae5;
            color: #047857;
            font-weight: bold;
        }

        /* Dev A - Blue */
        .timeline-cell.dev-a.active {
            background-color: #bfdbfe; /* blue-200 */
            color: #1e3a8a; /* blue-900 */
        }
        
        /* Dev B - Purple */
        .timeline-cell.dev-b.active {
            background-color: #e9d5ff; /* purple-200 */
            color: #581c87; /* purple-900 */
        }
        
        /* Hover states for colored cells */
        .timeline-cell.dev-a:hover:not(.active) { background-color: #eff6ff; }
        .timeline-cell.dev-b:hover:not(.active) { background-color: #faf5ff; }

        /* Column Widths & Styles */
        .col-lv1 { width: 80px; text-align: center; }
        .col-lv2 { width: 120px; }
        .col-lv3 { width: 250px; }
        .col-lv4 { width: 80px; text-align: center; } /* 난이도 */
        .col-lv5 { width: 100px; text-align: center; } /* 담당 */
        
        /* Phase Cell Styling (Merged) */
        .phase-cell {
            background-color: #fff;
            vertical-align: middle;
            text-align: center;
            font-weight: bold;
            color: #111827;
        }

        /* Loading & Error States */
        #loading-message {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: #4b5563;
            font-weight: 500;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden text-gray-800">

    <!-- Toolbar -->
    <header class="bg-white border-b border-gray-200 px-4 py-2 flex items-center justify-between shadow-sm z-20 h-[60px]">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-green-600 rounded flex items-center justify-center text-white font-bold text-lg">S</div>
            <div>
                <h1 class="font-bold text-lg leading-tight">canD 솔루션 개발 일정표</h1>
                <p class="text-xs text-gray-500">자동 저장됨 • 편집 가능</p>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="exportToCSV()" class="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                CSV 내보내기
            </button>
        </div>
    </header>

    <!-- Spreadsheet Area -->
    <main class="flex-1 bg-gray-100 p-2 overflow-hidden">
        <div id="loading-message">
            데이터를 불러오는 중입니다...
        </div>
        
        <div class="sheet-container rounded shadow-sm h-full hidden" id="sheet-container">
            <table id="schedule-table">
                <thead>
                    <tr>
                        <th class="w-10 z-30 bg-gray-100">#</th>
                        <th class="col-lv1">Lv1 (단계)</th>
                        <th class="col-lv2">Lv2 (기능 그룹)</th>
                        <th class="col-lv3">Lv3 (상세 업무)</th>
                        <th class="col-lv4">Lv4 (난이도)</th>
                        <th class="col-lv5">Lv5 (담당)</th>
                        <!-- Weeks Headers -->
                        <th class="w-16">1월(1주)</th>
                        <th class="w-16">1월(2주)</th>
                        <th class="w-16">1월(3주)</th>
                        <th class="w-16">1월(4주)</th>
                        <th class="w-16">2월(5주)</th>
                        <th class="w-16">2월(6주)</th>
                        <th class="w-16">2월(7주)</th>
                        <th class="w-16">2월(8주)</th>
                        <th class="w-16">3월(9주)</th>
                        <th class="w-16">3월(10주)</th>
                        <th class="w-16">3월(11주)</th>
                        <th class="w-16">3월(12주)</th>
                    </tr>
                </thead>
                <tbody id="table-body" class="bg-white">
                    <!-- Rows will be populated by JS -->
                </tbody>
            </table>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Initial Data (Lv1, Lv2, Lv3, Difficulty, Assignee, Timeline)
                // Note: Lv1 data is normalized in logic below to handle grouping
                const rawData = [
                    ["Phase 1", "공통/기반", "프로젝트 세팅 및 DB 설계", "하", "Dev A", [1,0,0,0,0,0,0,0,0,0,0,0]],
                    ["", "", "API 공통 모듈 & 인증(JWT)", "하", "Dev B", [1,0,0,0,0,0,0,0,0,0,0,0]],
                    ["", "", "좋아요/북마크 공통 모듈", "하", "Dev A", [0,0,0,1,0,0,0,0,0,0,0,0]],
                    ["Phase 1", "회원", "프로필 조회/수정 기능", "하", "Dev B", [1,0,0,0,0,0,0,0,0,0,0,0]],
                    ["", "", "마이페이지 활동 정보 조회", "하", "Dev B", [1,0,0,0,0,0,0,0,0,0,0,0]],
                    ["", "", "팔로우/언팔로우 및 목록", "하", "Dev B", [0,1,0,0,0,0,0,0,0,0,0,0]],
                    ["Phase 1", "매거진", "매거진 목록/상세 API", "하", "Dev A", [1,0,0,0,0,0,0,0,0,0,0,0]],
                    ["", "", "매거진 북마크/공유 기능", "하", "Dev A", [0,1,0,0,0,0,0,0,0,0,0,0]],
                    ["Phase 1", "홈/검색", "메인 배너/인기 콘텐츠 노출", "하", "Dev A", [1,0,0,0,0,0,0,0,0,0,0,0]],
                    ["", "", "통합 검색 (매거진, 포스트)", "하", "Dev A", [0,1,0,0,0,0,0,0,0,0,0,0]],
                    ["Phase 1", "알림/이벤트", "알림 목록 조회 (단순)", "하", "Dev B", [0,1,0,0,0,0,0,0,0,0,0,0]],
                    ["", "", "이벤트 목록/상세 페이지", "하", "Dev A", [0,0,1,0,0,0,0,0,0,0,0,0]],
                    ["", "", "이벤트 참여 신청 폼", "하", "Dev A", [0,0,1,0,0,0,0,0,0,0,0,0]],
                    ["Phase 1", "관리자", "금칙어/태그/배지 관리", "하", "Dev B", [0,0,1,0,0,0,0,0,0,0,0,0]],
                    ["", "", "공지사항 및 약관 관리", "하", "Dev B", [0,0,1,0,0,0,0,0,0,0,0,0]],
                    ["", "", "크리에이터 회원 관리", "하", "Dev B", [0,0,0,1,0,0,0,0,0,0,0,0]],
                    ["Phase 1", "콘텐츠", "리뷰/Q&A 조회 (View)", "하", "Dev A", [0,0,0,1,0,0,0,0,0,0,0,0]],
                    ["Phase 1", "배포", "1차 통합 테스트 및 MVP 배포", "-", "Dev B", [0,0,0,1,0,0,0,0,0,0,0,0]],
                    ["Phase 2", "포스트", "작성 (이미지/영상 업로드)", "상", "Dev A", [0,0,0,0,1,0,0,0,0,0,0,0]],
                    ["", "", "임시 저장 및 태그 연동", "중", "Dev A", [0,0,0,0,1,0,0,0,0,0,0,0]],
                    ["", "", "피드 알고리즘 (인기/팔로잉)", "상", "Dev A", [0,0,0,0,0,1,0,0,0,0,0,0]],
                    ["Phase 2", "메시징", "채팅 서버 구축 (Socket)", "상", "Dev B", [0,0,0,0,1,0,0,0,0,0,0,0]],
                    ["", "", "채팅방 생성/참여자 관리", "상", "Dev B", [0,0,0,0,1,0,0,0,0,0,0,0]],
                    ["", "", "실시간 메시지/Push 알림", "상", "Dev B", [0,0,0,0,0,1,0,0,0,0,0,0]],
                    ["", "", "미디어 전송/나가기 처리", "상", "Dev B", [0,0,0,0,0,1,0,0,0,0,0,0]],
                    ["Phase 2", "투표/댓글", "계층형 댓글(대댓글)", "중", "Dev A", [0,0,0,0,0,1,0,0,0,0,0,0]],
                    ["", "", "A/B 투표 생성/수정", "상", "Dev A", [0,0,0,0,0,0,1,0,0,0,0,0]],
                    ["", "", "투표 참여/실시간 집계", "상", "Dev A", [0,0,0,0,0,0,1,0,0,0,0,0]],
                    ["Phase 2", "Candy", "포인트 정책/적립/사용", "상", "Dev B", [0,0,0,0,0,0,1,0,0,0,0,0]],
                    ["", "", "포인트 이력/무결성 검증", "상", "Dev B", [0,0,0,0,0,0,1,0,0,0,0,0]],
                    ["Phase 2", "Quest", "퀘스트/트리거 생성(Admin)", "상", "Dev B", [0,0,0,0,0,0,0,1,0,0,0,0]],
                    ["", "", "사용자 행동 감지 시스템", "상", "Dev B", [0,0,0,0,0,0,0,1,0,0,0,0]],
                    ["", "", "달성 검증/보상 지급", "상", "Dev B", [0,0,0,0,0,0,0,0,1,0,0,0]],
                    ["", "", "현황 시각화/보상 UI", "중", "Dev A", [0,0,0,0,0,0,0,0,1,0,0,0]],
                    ["Phase 2", "기타", "리뷰/Q&A 답변/베스트 선정", "중", "Dev A", [0,0,0,0,0,0,0,1,0,0,0,0]],
                    ["", "", "유해 콘텐츠 신고(FE)", "중", "Dev A", [0,0,0,0,0,0,0,1,0,0,0,0]],
                    ["", "", "마이홈 (쓴글/참여 모음)", "중", "Dev A", [0,0,0,0,0,0,0,0,1,0,0,0]],
                    ["Phase 2", "관리/통계", "봇(Bot) 자동 알림 설정", "중", "Dev B", [0,0,0,0,0,0,0,0,1,0,0,0]],
                    ["", "", "인기 콘텐츠 선정 대시보드", "중", "Dev A", [0,0,0,0,0,0,0,0,0,1,0,0]],
                    ["", "", "콘텐츠 반응 통계 집계", "중", "Dev A", [0,0,0,0,0,0,0,0,0,1,0,0]],
                    ["", "", "신고 처리/자동 제재", "상", "Dev B", [0,0,0,0,0,0,0,0,0,1,0,0]],
                    ["", "", "이벤트 당첨자 추첨", "중", "Dev B", [0,0,0,0,0,0,0,0,0,1,0,0]],
                    ["Phase 2", "최적화/QA", "이미지 로딩 최적화/캐싱", "-", "Dev A", [0,0,0,0,0,0,0,0,0,0,1,0]],
                    ["", "", "UI/UX 버그 수정", "-", "Dev A", [0,0,0,0,0,0,0,0,0,0,1,0]],
                    ["", "", "대용량 쿼리 튜닝/보안", "-", "Dev B", [0,0,0,0,0,0,0,0,0,0,1,0]],
                    ["Phase 2", "최종", "최종 테스트/런칭 준비", "-", "Dev A", [0,0,0,0,0,0,0,0,0,0,0,1]],
                    ["", "", "운영 배포/모니터링", "-", "Dev B", [0,0,0,0,0,0,0,0,0,0,0,1]]
                ];

                // 1. Preprocess: Normalize Lv1 (Phase) data
                let lastPhase = "";
                const scheduleData = rawData.map(row => {
                    if (row[0] && row[0].trim() !== "") {
                        lastPhase = row[0];
                    } else {
                        row[0] = lastPhase;
                    }
                    return row;
                });

                // 2. Calculate Rowspans for Lv1
                const rowspans = [];
                let currentPhase = "";
                let count = 0;
                let startIndex = 0;

                scheduleData.forEach((row, index) => {
                    if (row[0] !== currentPhase) {
                        if (count > 0) {
                            rowspans[startIndex] = count;
                        }
                        currentPhase = row[0];
                        count = 1;
                        startIndex = index;
                    } else {
                        count++;
                    }
                });
                rowspans[startIndex] = count; // Final group

                // 3. Render
                const tableBody = document.getElementById('table-body');
                if (!tableBody) throw new Error("테이블 본문을 찾을 수 없습니다.");

                scheduleData.forEach((row, index) => {
                    const tr = document.createElement('tr');
                    
                    // Row Number
                    const tdNum = document.createElement('td');
                    tdNum.className = 'row-num';
                    tdNum.textContent = index + 1;
                    tr.appendChild(tdNum);

                    // Lv1 (Phase) - Merged Cell
                    if (rowspans[index]) {
                        const td = document.createElement('td');
                        td.textContent = row[0];
                        td.rowSpan = rowspans[index];
                        td.className = 'phase-cell border-b border-gray-300';
                        td.contentEditable = "true";
                        tr.appendChild(td);
                    } else if (!currentPhase || row[0] !== currentPhase) {
                        // Skip merged
                    }

                    // Determine assignee for this row (Lv5 is at index 4)
                    const assignee = row[4]; 
                    let assigneeClass = "";
                    if (assignee.includes("Dev A")) assigneeClass = "dev-a";
                    if (assignee.includes("Dev B")) assigneeClass = "dev-b";

                    // Lv2 ~ Lv5 (Columns 1 to 4)
                    for (let i = 1; i < 5; i++) {
                        const td = document.createElement('td');
                        td.contentEditable = "true";
                        td.textContent = row[i];
                        
                        if (i === 1) { // Lv2
                             td.className = 'font-medium text-gray-900 bg-gray-50';
                        } else if (i === 3 || i === 4) { // Lv4, Lv5
                             td.className = 'text-center text-gray-700';
                             // Difficulty Color
                             if (i === 3 && row[i] === "상") td.classList.add("text-red-600", "font-medium");
                             // Assignee Text Color
                             if (i === 4) {
                                if (assigneeClass === "dev-a") td.classList.add("text-blue-600", "font-medium");
                                if (assigneeClass === "dev-b") td.classList.add("text-purple-600", "font-medium");
                             }
                        } else {
                             td.className = 'text-gray-700';
                        }
                        
                        // Empty placeholder check
                        if (row[i] === "" && i === 1) {
                           td.style.backgroundColor = 'white';
                        }
                        tr.appendChild(td);
                    }

                    // Timeline Columns (index 5)
                    const timelineData = row[5];
                    timelineData.forEach(isActive => {
                        const td = document.createElement('td');
                        
                        // Add base class and specific assignee class
                        td.className = 'timeline-cell ' + assigneeClass;
                        
                        if (isActive) {
                            td.classList.add('active');
                            td.textContent = '■';
                        }
                        
                        td.onclick = function() {
                            this.classList.toggle('active');
                            this.textContent = this.classList.contains('active') ? '■' : '';
                        };
                        
                        tr.appendChild(td);
                    });

                    tableBody.appendChild(tr);
                });

                // Show Content
                document.getElementById('loading-message').style.display = 'none';
                document.getElementById('sheet-container').classList.remove('hidden');

            } catch (error) {
                console.error("Rendering Error:", error);
                const loadingMsg = document.getElementById('loading-message');
                loadingMsg.innerHTML = `<div class="text-red-500">오류가 발생했습니다.<br>${error.message}</div>`;
            }
        });

        // Export to CSV Function
        function exportToCSV() {
            let csvContent = "\uFEFF";
            
            // Header
            const headerRow = ["Lv1", "Lv2", "Lv3", "Lv4(난이도)", "Lv5(담당)", "1월(1주)", "1월(2주)", "1월(3주)", "1월(4주)", "2월(5주)", "2월(6주)", "2월(7주)", "2월(8주)", "3월(9주)", "3월(10주)", "3월(11주)", "3월(12주)"];
            csvContent += headerRow.join(",") + "\n";

            // Rows
            const rows = document.querySelectorAll('#table-body tr');
            
            let currentPhase = "";

            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                let rowData = [];
                let cellIndex = 0; 
                
                const firstDataCell = cells[1];
                let hasPhaseCell = firstDataCell.classList.contains('phase-cell');
                
                if (hasPhaseCell) {
                    currentPhase = firstDataCell.innerText;
                    rowData.push(escapeCSV(currentPhase));
                    cellIndex = 2; 
                } else {
                    rowData.push(escapeCSV(currentPhase));
                    cellIndex = 1; 
                }

                // Push Lv2 ~ Lv5
                for (let i = 0; i < 4; i++) {
                    rowData.push(escapeCSV(cells[cellIndex + i].innerText));
                }
                
                let timelineStartIndex = hasPhaseCell ? 6 : 5;
                for (let i = timelineStartIndex; i < cells.length; i++) {
                    rowData.push(cells[i].classList.contains('active') ? "■" : "");
                }

                csvContent += rowData.join(",") + "\n";
            });

            const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "development_schedule.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function escapeCSV(text) {
            if (!text) return "";
            let val = text.replace(/"/g, '""');
            if (val.includes(',')) val = `"${val}"`;
            return val;
        }
    </script>
</body>
</html>
